![network.png](nlegend/network.png)

# 计算机网络

---

# 1 计算机网络体系结构

## 1.1 计算机网络概述

### 1.1.1 概念

计算机网络是由自治计算机互联起来的集合体，其中包含三个关键点：自治计算机、互联、集合体

- 自治计算机：由软件和硬件组成，能完整实现计算机各种功能
- 互联：计算机之间能相互通信
- 集合体：有通信线路和互联设备连接起来的自治计算机集合

### 1.1.2 组成

1. 从组成部分上看：主要由硬件、软件和协议三大部分组成
2. 从工作方式上看：边缘部分和核心部分
3. 从功能组成上看：由通信子网和资源子网，由传输层分割
   - 通信子网：
     - 由通信线路、通信设备及相应的网络协议组成，
     - 它使网络具有数据传输，交换，控制，存储的能力。
     - 包括物理层，数据链路层，网络层
   - 资源子网
     - 主要由计算机系统、终端、联网外部设备、各种软件资源和信息资源组成
     - 负责数据处理，并向网络用户提供各种网络资源和服务
     - 包括应用层、表示层、会话层

### 1.1.3 功能

计算机网络有五大功能：数据通信、资源共享、分布式处理、提高可靠性、负载均衡（前三个为主要功能）

### 1.1.4 分类

按网络覆盖范围：广域网（wide area network）、城域网、局域网、个人区域网

- 城域网：可视为为了满足一定区域需求，而将多个局域网互联的局域网
- 广域网和局域网的差异不仅在于覆盖范围，而且还在于所采用的协议和网络技术，前者使用的是点对点等技术，后者使用广播技术

按拓扑结构：星形，总线形，环形（令牌环），网状形

按传输技术：广播式、点对点

- 是否采用分组存储转发与路由选择机制是点对点与广播式之间的重要差异

按交换技术：电路交换（建立专用通路），报文交换（报文长度未知），分组交换（长度固定的数据块，存储转发）

按传输介质：有线（双绞线，同轴电缆）和无线（蓝牙，微波，无线电）

### 1.1.5 性能指标

1. 带宽（bandwidth）
   - 带宽在通信线路中指的是信号频带范围
   - 在计算机网络中，网络通信线路所能传输数据的能力，指数字信道所能传输的“最高数据率”，单位比特/秒（b/s）
2. 时延（Delay）
   - 由四部分组成：发送时延，传播时延，处理时延，排队时延
   - 发送时延 = 分组长度 / 带宽
   - 传播时延 = 信道长度 / 电磁波在信道介质中的传播速率
   - 总时延 = 四者之和
3. 时延带宽积
   - 指从发送端发送的第一个比特即将到达终点时，发送端已经发出了多少个比特
   - 时延带宽积 = 传播时延 x 信道带宽
4. 往返时延：
   - 指从发送端发送数据开始，到发送端收到来自接受端的确认，总共经历的时延
5. 吞吐量（Throughput），指单位时间内通过某个网络的数据量，它受网络带宽或网络额定速率的限制
6. 信道利用率
   - 信道利用率 = 有数据通过时间 / （有 + 无）数据通过时间
7. 

其他：

1. 世界上第一个计算机网络是ARPAnet，是Internet 的前身

## 1.2 体系结构与参考模型

### 1.2.1 分层结构

计算机网络的各层及其协议的集合称为网络的体系结构，它是计算机网络中的层次，各层的协议及层间接口的集合。

在分层机构中，第n层中的活动元素通常称为n层实体。同一层的实体称为对等实体。

在计算机网络体系结构的各个层次中，每个信息单位都分为两部分：

- 一部分是数据部分（服务数据单元SDU），一部分是控制信息（协议控制信息PCI）。
- 它们共同组成协议数据单元PDU，
- 链路层的PDU为帧，网络层为分组，传输层为报文
- n-SDU + n-PCI = n-PDU = n-SDU

### 1.2.2 协议、接口、服务

OSI参考模型的3个主要概念

**协议**：就是规则的集合，对等实体间才有协议，是水平的，协议由语法、语义、同步三部分构成

**接口**：是同一结点内相邻两层间交换信息的连接点，下层的服务通过服务访问点（Service Access Point，SAP）提供给上层使用

**服务**：指下层为紧邻的上层提供的功能调用，是垂直的。上层要求服务，下层提供服务

- 计算机网络提供的服务科按以下三种方式分类
- 面向连接与无连接服务，
  - 前者需要建立连接，分配相应资源，例如**TCP**就是面向连接的协议
  - 后者无需先建立连接，需要发送数据时可直接发送，尽最大努力交付（Best-Effort-Delivery）,例如**IP和UDP**就是无连接的协议
- 可靠和不可靠服务
  - 可靠服务是指网络具有纠错，检错，应答机制，能保证数据正确，可靠地传送到目的地
  - 对于不可靠服务网络，**其网络正确性由应用或用户来保障**
- 有应答和无应答
  - 有应答服务是指接收方在收到数据后向发送方给出相应的应答，例如文件传输服务就是有应答服务
  - **www服务**是无应答服务，客户端收到页面文件后不给服务器应答

### 1.2.3 参考模型

![](./legend/计算机网络体系结构.png)

#### OSI模型

1. 七层，物链网输会示用，谐音助记：物联网谁会使用
2. 通信子网：下三层，资源子网：上三层
3. 物理层
   - 传输单位：比特流
   - 任务：透明的传输比特流
   - 功能：定义接口特性（物理设备）、传输模式（单双工）、传输速率
   - 典型协议：EIA-232C
4. 数据链路层
   - 传输单位：帧
   - 任务：将网络层传来的IP分组组装成帧
   - 功能：成帧、差错控制、流量控制（数据链路层及以上层）和传输管理等
   - 典型协议：SDLC、HDLC、PPP、STP
   - 实现相邻结点之间即点到点的数据传输服务
5. 网络层
   - 传输单位：数据报，数据报过长会被切割为分组
   - 任务：将数据单元（分组）从源端传到目的端
   - 功能：流量控制、拥塞控制、差错控制和网际互联等
   - 典型协议：IP、IPX、ICMP、IGMP、ARP、RARP、OSPF
   - 实现主机到主机的通信
6. 传输层
   - 传输单位：报文段（TCP）或用户数据报（UDP）
   - 任务：负责主机中两个进程之间的通信
   - 功能：流量控制、差错控制、服务质量。数据传输管理等
   - 实现主机进程间的端到端可靠数据传输服务（一个进程由端口标识，故为端到端）
   - 高层用户可以进行端到端的数据传输，而忽略通信子网的村子，在这层子网会发生交替变换
   - 因一个主机可运行多个进程，因而传输层具备复用和分用的功能，
     - 复用：多个应用层进程可同时使用下面传输层的服务
     - 分用：指传输层把收到的信息分别交付给上面的应用层中相应进程
   - 典型协议：TCP、UDP
7. 会话层
   + 利用传输层提供的端到端服务，向表示层提供它的增值服务。
   + 会话可以使用校验点继续恢复通信，实现数据同步
   + 管理主机间的会话进程，包括建立、管理及终止进程间的会话
   + 典型协议：ADSP、ASP
8. 表示层
   - 主要处理在两个通信系统中交换信息的表示方式，包括数据压缩，加解密等数据表示变换功能
9. 应用层
   - 是用户与网络的界面，为特定的网络应用提供访问OSI环境的手段，应用层是最复杂的一层，协议也最多
   - 典型协议：HTTP（万维网），FTP（文件传输），SMTP（电子邮件）

#### TCP/IP模型

1. 四层，应用层、传输层、网际层、网络接口层
2. 应用层：应用层、表示层、会话层
3. 传输层：传输层，
   - TCP/IP包含面向连接和无连接两种模式，而OSI只有面向连接的模式
4. 网际层：网络层
   - TCP/IP只有无连接模式，而OSI包含面向连接和无连接两种模式
5. 网络接口层：物理层、数据链路层

其他：

1. 集线器是一个多端口的中继器，它工作在物理层
2. 以太网交换机是一个多端口网桥，它工作在数据链路层
3. 路由器是网络层设备，它实现了OSI网络模型的下三层

# 2 物理层

## 2.1 通信基础

### 2.1.1 基本概念

数据：传送信息的实体

信号：指数据的电气或电磁表现，数据和信号都可以用模拟的和数字的来修饰

码元：一个固定时长的信号波形。用这个波形表示一个k进制的数字，这个时长称为码元宽度。

码元传输速率M：单位时间内数字通信系统所传输的码元个数，单位波特。

信息传输速率D：单位时间内数字通信系统所传输的**二进制码元**个数，D = M * n。k = 2^n

奈奎斯特定理：

- 理想低通信道下，极限数据传输率 = 2W logV

- W是理想低通信道的带宽，单位hz

- V是一个码元能代表多少种数据，也k，例如16进制，V就等于16

- log以2为底

- ###### 为避免码间串扰，码元的极限传输速率为2W Baud。若传输速率超过此上限，就会出现严重的码间串扰

- 奈氏准则给出了码元传输速率的限制

香农定理

- 信道的极限数据传输率 = W log（1+ S/N）
- W为带宽，S为信号功率，N为噪声功率
- 只要信息的传输速率低于信道的极限传输速率，就能找到某种方法实现无差错传输。
- 香农定理信息传输速率的限制

## 2.2 传输介质

1. 双绞线
   - 由两根，并排绞合（减少电磁干扰），相互绝缘的铜导线组成。有的还在双绞线外面加了金属丝屏蔽层
   - 典型：以太网线
   - 在局域网和传统电话网运用较为普遍，近距离（几千米到几十千米，过远要加中继器和放大器）
2. 同轴电缆
   - 内由同中心轴的导体，绝缘层，网状屏蔽层和塑料外层构成
   - 75Ω同轴电缆——闭路电视线，
   - 传输距离更远
3. 光纤
   - 利用光导纤维传递光脉冲来通信
   - 多模光纤（脉冲容易展宽，造成失真），利用全反射，近距离传输
   - 单模光纤（直径减小到一个光波长度），没有反射，光沿直线传播，远距离传输
4. 无线传输
   - 无线电波，如手机，无线局域网WLAN
   - 高带宽无线通信：微波，红外和激光
     - 他们都需要发送方和接收方存在一条视线通道，有很强方向性
     - 微波，例如地面上的塔基站之间，卫星通信
5. 物理接口特性
   - 机械特性：外观上的
   - 电气特性：电路上的
   - 功能特性：含义和用途
   - 规程特性：规程和时序关系
6. 

## 2.3 物理层设备

### 2.3.1 中继器

中继器（repeater，RP）又称转发器，主要功能：对信号，**整形**并**放大**后**转发**出去

- 中继器有两个端口，数据从一个端输入，一个端输出（没有固定哪个端口为输入，没有方向性），端口仅作用于信号的电气部分。
- 中继器没有存储转发功能，不能连接两个不同的协议，不能连接数据速率不同的同一网段不同的两个子网段
- 中继器放大的是数字信号，放大器放大的是模拟信号
- 中继器或集线器有5-4-3原则，最多连接5个子网段，4个中继器或集线器，只有3个子网段可以搭载主机，其余两个子网段只能用于延长连接距离。

网段（network segment）：一般指一个计算机网络中使用同一物理层设备（传输介质，中继器，集线器等）能够直接通讯的那一部分。

- 设备间通过相同传输介质直接连接，设备属于同一网段
- 设备间通过传输介质而非直接连接，但传输介质通过物理层扩展设备（中继器or集线器）转接，设备属于同一网段，扩展设备两端连接的是同一网段的不同子网段

### 2.3.2 集线器

集线器（Hub）实质是一个多端口中继器

- 功能：把从一个端口收到的数据通过所有其他端口转发出去。
- Hub只能在半双工状态下工作（即一个端口输入，其他端口输出，不能多输入），所有集线器的端口都属于同一个冲突域，在同一个时钟周期内只能传输一组信息。集线器在物理层上扩大了物理网络的覆盖范围，无法解决冲突域（第二层交换机可解决）与广播域（第三层交换机可解决）
- 拓扑结构属于星形

冲突域

- 一次只有一个设备发送信息，其他设备只能等待，否则会发生冲突
- 第二层交换机可解决冲突域的问题

广播域

- 接收同样广播消息的节点的集合。
- 第三层交换机可解决广播域的问题

# 6. 应用层

## 6.1 网络应用模型

### 6.1.1 C/S

Client/Server——客户/服务器模型

- 客户是服务请求方，服务器是服务提供方
- 服务器处于监听请求状态
- 客户机发出请求，并等待返回请求结果
- 服务器收到请求，处理请求，返回结果给客户机

特点：

- 地位不平等，服务器对用户的权限限制来管理客户机
- 客户机相互间不直接通信
- 扩展性不佳，受服务器的影响，支持客户机数量有限，**服务器的性能决定了整个系统的性能**

### 6.1.2 P2P

整个网络中的传输内容不再被保存到中心服务器上，每个节点都同时具有下载上传功能。

任意一对计算机——对等方（peer），直接相互通信。每个节点即可作为客户访问其它节点的资源，也可以作为服务器提供资源给其它节点。

特点：

- 减轻服务器压力，将任务分配到各个节点上
- 多个客户机直接分享资源
- 扩展性好
- 网络健壮性强
- 获取服务同时还要提供服务，对整机性能有影响
- 对硬盘有损伤，会造成网络拥堵